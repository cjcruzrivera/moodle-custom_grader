function _createForOfIteratorHelper(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);if(b)d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable});c.push.apply(c,d)}return c}function _objectSpread(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};if(b%2){ownKeys(Object(c),!0).forEach(function(b){_defineProperty(a,b,c[b])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(a,Object.getOwnPropertyDescriptors(c))}else{ownKeys(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}}return a}function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("local_customgrader/grader-store",["local_customgrader/grader-utils","local_customgrader/grader-enums","local_customgrader/grader-service","local_customgrader/vendor-vue","local_customgrader/vendor-lodash"],function(a,b,c,d,e){var f,g,h=function(a,c){switch(c.name){case b.sortStudentMethods.FIRST_NAME:return e.orderBy(a,["firstname"],c.order);case b.sortStudentMethods.LAST_NAME:return e.orderBy(a,["lastname"],c.order);}},j={ADD_GRADE:"addGrade",DELETE_CATEGORY:"deleteCategory",ADD_ITEM:"addItem",ADD_CATEGORY:"addCategory",ADD_GRADE_TO_STUDENT:"addGradeToStudent",SET_STATE:"setAllState",SET_GRADE:"setGrade",SET_GRADES:"setGrades",SET_CATEGORY:"setCategory",SET_STUDENT_SORT_METHOD:"setStudentSortMethod",SET_SELECTED_CATEGORY_ID:"setSelectedCategoryId",SET_LEVELS:"setLevels",SET_ITEM:"setItem",DELETE_ITEM:"deleteItem",DELETE_GRADE:"deleteItemGrades"},k={FETCH_STATE:"fetchAllState",FILL_GRADES:"fillGrades",FILL_GRADES_FOR_NEW_ITEM:"fillGradesForNewItem",UPDATE_GRADE:"updateGrade",DELETE_ITEM:"deleteItem",DELETE_CATEGORY_CHILDS:"deleteCategoryChilds",UPDATE_CATEGORY:"setCategory",ADD_ITEM:"addItem",ADD_PARTIAL_EXAM:"addPartialExam",DELETE_CATEGORY:"deleteCategory",ADD_CATEGORY:"addCategory",UPDATE_ITEM:"setItem",DELETE_ITEM_GRADES:"deleteItemGrades"},l={state:{decimalPlaces:2,additionalColumnsAtFirst:[{text:"C\xF3digo estudiante"},{text:"",hide:!0}],additionalColumnsAtEnd:[{text:"Nota final"}],sortStudentsMethodType:{name:b.sortStudentMethods.LAST_NAME,order:b.sortDirection.ASC},students:{},selectedCategoryId:null,items:{},categories:[],grades:{},levels:[],course:{fullname:"Nombre completo de el curso"},maxDisplayGrade:5,gradeDisplayRange:.5},mutations:(f={},_defineProperty(f,j.DELETE_ITEM,function(a,b){d.delete(a.items,b)}),_defineProperty(f,j.DELETE_CATEGORY,function(a,b){var c=a.categories.map(function(a){return a.id}).indexOf(b);d.delete(a.categories,c)}),_defineProperty(f,j.SET_STUDENT_SORT_METHOD,function(a,b){a.sortStudentsMethodType=b}),_defineProperty(f,j.DELETE_GRADE,function(a,b){Object.keys(a.students).forEach(function(c){var e=a.students[c];d.set(a.students[c],"gradeIds",e.gradeIds.filter(function(a){return a!==b}))});d.delete(a.grades,b)}),_defineProperty(f,j.ADD_ITEM,function(a,b){d.set(a.items,b.id,b)}),_defineProperty(f,j.ADD_CATEGORY,function(a,b){a.categories.push(b)}),_defineProperty(f,j.ADD_GRADE,function(b,c){c.id=a.ID();var e=b.students[c.userid],f=e.gradeIds?e.gradeIds:[];d.set(b.grades,c.id,c);d.set(b.students[e.id],"gradeIds",[].concat(_toConsumableArray(f),[c.id]))}),_defineProperty(f,j.ADD_GRADE_TO_STUDENT,function(a,b){var c=b.grade,e=b.studentId,f=a.students[e],g=f.gradeIds?f.gradeIds:[];d.set(a.students[e],"gradeIds",[].concat(_toConsumableArray(g),[c.id]))}),_defineProperty(f,j.SET_ITEM,function(a,b){d.set(a.items,b.id,b)}),_defineProperty(f,j.SET_LEVELS,function(a,b){a.levels=b}),_defineProperty(f,j.SET_CATEGORY,function(a,b){var c=a.categories.map(function(a){return a.id}).indexOf(b.id);d.set(a.categories,c,b)}),_defineProperty(f,j.SET_GRADES,function(b,c){c.forEach(function(c){var e=Object.values(b.grades).find(function(a){return a.itemid===c.itemid&&a.userid===c.userid});c.finalgrade=a.removeInsignificantTrailZeros(c.finalgrade);if(e.finalgrade!=c.finalgrade){console.log("nel prro");if(!b.grades[c.id]){b.grades[c.id]=c;var f=b.students[e.userid].gradeIds,g=[].concat(_toConsumableArray(f.filter(function(a){return a!==e.id})),[c.id]);b.students[c.userid]=_objectSpread({},b.students[c.userid],{gradeIds:g});d.delete(b.grades,e.id)}d.set(b.grades,c.id,c)}})}),_defineProperty(f,j.SET_GRADE,function(b,c){var e=c.old,f=c.new;f.finalgrade=a.removeInsignificantTrailZeros(f.finalgrade);b.grades[f.id]=f;if(e){if(e.id!==f.id){var g=b.students[e.userid].gradeIds,h=[].concat(_toConsumableArray(g.filter(function(a){return a!==e.id})),[f.id]);b.students[e.userid]=_objectSpread({},b.students[e.userid],{gradeIds:h});d.delete(b.grades,e.id)}}}),_defineProperty(f,j.SET_SELECTED_CATEGORY_ID,function(a,b){a.selectedCategoryId=b}),_defineProperty(f,j.SET_STATE,function(b,c){b.levels=c.levels;var d={};c.students.forEach(function(a){d[a.id]=a});b.students=d;var e={};c.items.forEach(function(a){e[a.id]=a});b.items=e;b.categories=c.categories;var f={};c.grades.forEach(function(b){f[b.id]=_objectSpread({},b,{finalgrade:a.removeInsignificantTrailZeros(b.finalgrade)})});b.grades=f;b.course=c.course}),f),actions:(g={},_defineProperty(g,k.DELETE_ITEM,function(a,b){var d=a.commit,e=a.dispatch,f=a.state;c.delete_item(b).then(function(a){d(j.SET_LEVELS,a.levels);d(j.DELETE_ITEM,b);e(k.DELETE_ITEM_GRADES,b)})}),_defineProperty(g,k.ADD_ITEM,function(a,b){var d=a.commit,e=a.dispatch;c.add_item(b).then(function(a){d(j.ADD_ITEM,a.item);d(j.SET_LEVELS,a.levels);e(k.FILL_GRADES_FOR_NEW_ITEM,a.item)})}),_defineProperty(g,k.DELETE_ITEM_GRADES,function(a,b){var c=a.commit,d=a.state,e=Object.keys(d.grades),f=[];e.forEach(function(a){if(d.grades[a].itemid===b){f.push(a)}});f.forEach(function(a){c(j.DELETE_GRADE,a)})}),_defineProperty(g,k.ADD_PARTIAL_EXAM,function(a,b){var d=a.commit,e=a.getters;c.add_partial_exam(b).then(function(a){d(j.SET_LEVELS,a.levels);d(j.ADD_CATEGORY,a.category);d(j.ADD_ITEM,a.partial_item);d(j.ADD_ITEM,a.optional_item)})}),_defineProperty(g,k.DELETE_CATEGORY_CHILDS,function(a,b){var c=a.commit,d=a.getters,e=a.dispatch,f=d.categoryChildItems(b),g=d.categoryChildCategories(b);f.forEach(function(a){c(j.DELETE_ITEM,a.id);e(k.DELETE_ITEM_GRADES,a.id)});g.forEach(function(a){c(j.DELETE_CATEGORY,a.id)})}),_defineProperty(g,k.DELETE_CATEGORY,function(a,b){var d=a.commit,e=a.getters,f=a.dispatch;c.delete_category(b).then(function(a){d(j.SET_LEVELS,a.levels);f(k.DELETE_CATEGORY_CHILDS,b);d(j.DELETE_CATEGORY,b)})}),_defineProperty(g,k.FILL_GRADES_FOR_NEW_ITEM,function(a,b){var c=a.commit,d=a.state,e=a.getters,f=Object.keys(d.students);f.forEach(function(a){var d={userid:a,itemid:b.id,finalgrade:null,rawgrademin:b.grademin,rawgrademax:b.grademax};c(j.ADD_GRADE,d)})}),_defineProperty(g,k.FILL_GRADES,function(a){var b=a.commit,c=a.state,d=a.getters,e=Object.keys(c.students),f=Object.values(c.grades);e.forEach(function(a){var e=_createForOfIteratorHelper(d.itemOrderIds),g;try{var h=function(){k=g.value;var d=c.items[k],e=f.find(function(b){return b.userid===a&&b.itemid===d.id});if(!e){var h={userid:a,itemid:d.id,finalgrade:null,rawgrademin:d.grademin,rawgrademax:d.grademax};b(j.ADD_GRADE,h)}else{b(j.ADD_GRADE_TO_STUDENT,{studentId:a,grade:e})}};for(e.s();!(g=e.n()).done;){var k;h()}}catch(a){e.e(a)}finally{e.f()}})}),_defineProperty(g,k.UPDATE_GRADE,function(a,b){var d=a.commit,e=a.state;c.update_grade(b,e.course.id).then(function(a){console.log(a);d(j.SET_GRADES,a.other_grades)})}),_defineProperty(g,k.UPDATE_CATEGORY,function(a,b){var d=a.dispatch,e=a.commit;c.update_category(b).then(function(a){var b=a.category,c=a.levels;e(j.SET_CATEGORY,b);e(j.SET_LEVELS,c)})}),_defineProperty(g,k.ADD_CATEGORY,function(a,b){var d=a.commit,e=a.state,f=a.dispatch;c.add_category(b.category,b.weight).then(function(a){var b=a.category,c=a.category_item,e=a.levels;d(j.ADD_ITEM,c);d(j.ADD_CATEGORY,b);d(j.SET_LEVELS,e);f(k.FILL_GRADES_FOR_NEW_ITEM,c)})}),_defineProperty(g,k.UPDATE_ITEM,function(a,b){var d=a.dispatch,e=a.commit;c.update_item(b).then(function(a){var b=a.item,c=a.levels;e(j.SET_ITEM,b);e(j.SET_LEVELS,c);e(j.SET_GRADES,a.other_grades)})}),_defineProperty(g,k.FETCH_STATE,function(b){var d=b.dispatch,e=b.commit;c.get_grader_data(a.getCourseId()).then(function(a){e(j.SET_STATE,a);d(k.FILL_GRADES)})}),g),getters:{courseLevel:function courseLevel(a){return a.levels[0]?a.levels[0][0]:[]},selectedCategory:function selectedCategory(a,b){return b.categoryById(a.selectedCategoryId)},itemLevel:function itemLevel(a){return a.levels[a.levels.length-1]},categoryLevels:function categoryLevels(a){var b=a.levels.slice(1,a.levels.length-1);return b?b:[]},itemsCount:function itemsCount(a){return Object.keys(a.items).length},categoryById:function categoryById(a){return function(b){return a.categories.find(function(a){return a.id===b})}},studentById:function studentById(a){return function(b){return a.students[b]}},studentSetSorted:function studentSetSorted(a,b){return h(b.studentSet,a.sortStudentsMethodType)},studentSet:function studentSet(a){return Object.values(a.students)},studentsCount:function studentsCount(a){return Object.keys(a.students).length},studentsAsesCount:function studentsAsesCount(a,b){return b.studentSet.filter(function(a){return a.is_ases}).length},itemSet:function itemSet(a){return Object.values(a.items)},isWeightHundred:function isWeightHundred(a,b){var c=b.getCategoryIds;if(!b.categoryWeightsIsHundred(c[0],!0)){return!1}for(i=1;i<c.length;i++){if(!b.categoryWeightsIsHundred(c[i])){return!1}}return!0},categoryWeightsIsHundred:function categoryWeightsIsHundred(a,b){return function(a){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,d=b.getWeightsByCat(a,c);console.log(d);var e=d.reduce(function(c,a){return c+a},0);console.log(e);return 0==e||100==e}},getWeightsByCat:function getWeightsByCat(a){return function(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,d=0;if(c){d=Object.values(a.items).map(function(a){if(a.categoryid==b||null==a.categoryid){return+a.aggregationcoef}else return 0})}else{d=Object.values(a.items).map(function(a){if(a.categoryid==b){return+a.aggregationcoef}else return 0})}return d}},getWeights:function getWeights(a){var b=Object.values(a.items).map(function(a){return+a.aggregationcoef});return b},getCategoryIds:function getCategoryIds(a){var b=Object.values(a.categories).map(function(a){return a.id});return b},itemOrderIds:function itemOrderIds(a,b){var c=b.itemLevel;if(!c){return Object.keys(a.items)}return c.map(function(a){return a.object.id})},itemOrderedNames:function itemOrderedNames(a,b){var c=b.itemLevel;if(!c){return Object.keys(a.items)}return c.map(function(a){if(null===a.object.itemname||""===a.object.itemname){return"Total "+b.categoryById(a.object.iteminstance).fullname}else return a.object.itemname})},finalGradeId:function finalGradeId(a,b){return b.itemOrderIds[b.itemOrderIds.length-1]},categoryChildItems:function categoryChildItems(a,b){return function(a){var c=b.itemSet.filter(function(b){return b.categoryid===a||b.iteminstance===a});if(Array.isArray(c)){return c}else{return[]}}},categoryChildCategories:function categoryChildCategories(a){return function(b){var c=a.categories.filter(function(a){return a.parent===b});return c?c:[]}},categoryChildSize:function categoryChildSize(a,b){return function(a){var c=b.categoryChildItems(a),d=b.categoryChildCategories(a);return c.length+d.length}},categoryDepth:function categoryDepth(a){if(0>=a.categories.length){return 0}var b=a.categories.map(function(a){return a.depth});return Math.max.apply(Math,b)},getCategoriesByDepth:function getCategoriesByDepth(a){return function(b){return a.categories.find(function(a){return a.depth===b})}},gradesSet:function gradesSet(a){return Object.values(a.grades)},gradesByItemId:function gradesByItemId(a,b){return function(a){return b.gradesSet.filter(function(b){return b.itemid===a})}},passingGrades:function passingGrades(a,b){return b.gradesSet.filter(function(a){return a.finalgrade>=.6*a.rawgrademax})},passingGradesSet:function passingGradesSet(a,b){return b.itemOrderIds.map(function(a){return b.gradesByItemId(a).filter(function(a){return a.finalgrade>=.6*a.rawgrademax}).length})},failingGrades:function failingGrades(a,b){return b.gradesSet.filter(function(a){return a.finalgrade<.6*a.rawgrademax&&null!=a.finalgrade})},failingGradesSet:function failingGradesSet(a,b){return b.itemOrderIds.map(function(a){return b.gradesByItemId(a).filter(function(a){if(a.finalgrade<.6*a.rawgrademax&&null!=a.finalgrade){return!0}else return!1}).length})},nullGrades:function nullGrades(a,b){return b.gradesSet.filter(function(a){return null===a.finalgrade||a.finalgrade===void 0})},nullGradesSet:function nullGradesSet(a,b){return b.itemOrderIds.map(function(a){return b.gradesByItemId(a).filter(function(a){return null===a.finalgrade||a.finalgrade===void 0}).length})},passingGradesCount:function passingGradesCount(a,b){return b.passingGrades.length},failingGradesCount:function failingGradesCount(a,b){return b.failingGrades.length},nullGradesCount:function nullGradesCount(a,b){return b.nullGrades.length},finalGradesSet:function finalGradesSet(a,b){return b.gradesSet.filter(function(a){return a.itemid===b.finalGradeId})},finalPassingGradeSet:function finalPassingGradeSet(a,b){return b.finalGradesSet.filter(function(a){return a.finalgrade>=.6*a.rawgrademax})},lineGraphLabel:function lineGraphLabel(a){var b=[],c=a.maxDisplayGrade/a.gradeDisplayRange,d=0,e="";for(i=0;i<c-1;i++){e=d+" - ";d+=a.gradeDisplayRange;e+=d-.1;b.push(e)}e=d+" - "+a.maxDisplayGrade;b.push(e);return b},getGradesByRange:function getGradesByRange(a,b){var c=0,d=a.gradeDisplayRange,e=[],f=a.maxDisplayGrade/a.gradeDisplayRange,g=b.finalGradesSet.map(function(b){return b.finalgrade/b.rawgrademax*a.maxDisplayGrade});for(i=0;i<f-1;i++){e.push(g.filter(function(a){return a>=c&&a<d}).length);c+=a.gradeDisplayRange;d+=a.gradeDisplayRange}e.push(g.filter(function(a){return a>=c}).length);return e}}};return{store:l,mutations:j,actions:k}});
//# sourceMappingURL=grader-store.min.js.map
