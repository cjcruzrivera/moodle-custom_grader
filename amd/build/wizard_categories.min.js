define ("local_customgrader/wizard_categories",["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(a){return{init:function init(){var m=a("<div class =\"mini-menu\"><i class=\"fa fa-plus\"></i></div>"),n=a("<div class =\"mini-menu\"><i class=\"fa fa-edit\" title=\"Editar \xCDtem\"></i><i class=\"fa fa-trash\"></i></div>");m.appendTo(a("th.category:not(.catlevel1)"));n.appendTo(a("th.item"));a(".mini-menu").attr("iditem",function(){return a(this).parent().attr("data-itemid")});a(".mini-menu").children().attr("iditem",function(){return a(this).parent().attr("iditem")});var o;a(document).on("click","#wizard_button",function(){a("#modalCategories").modal({backdrop:!1});a(".fondo").show();id=f();g(id)});a(document).on("click",".fa-plus",function(){a("#modalCategories").modal({backdrop:!1});a(".fondo").show();id=f();g(id)});a(document).on("click",".fa-edit",function(){id=f();g(id);var c="#"+a(this).attr("iditem");setTimeout(function(){b(a(c))},300)});a(document).on("click",".fa-trash",function(){id=f();g(id);var b="#"+a(this).attr("iditem");setTimeout(function(){$element=a(b).parent().children().last();console.log($element);c(a(b))},300)});a(document).on("click",".mymodal-close",function(){location.reload();a(".fondo").hide()});a(document).on("click",".edit",function(){console.log(a(this));var b=a(this).attr("title");a("#titulo").text(b);var c=!1;a("#nombre_editar").show();a("#label_nombre").show();a("#alta").show();a("#div_padres").show();if(a(this).hasClass("curso")){c=!0;a("#alta").hide();console.log("CURSO");a("#nombre_editar").hide();a("#label_nombre").hide();a("#div_padres").hide()}var e=f(),g=a(this).attr("id");a("#save_edit").attr("name",g);if("Editar Categor\xEDa"===b){a("#type_cal").show();var h=a(this).parent().parent().attr("id");a("#otro").hide();if(10!=h&&0!=h&&6!=h){h=99;a("#otro").show()}a("#calific").prop("value",h);var i="cat",j=a(this).parent().parent().text();if(-1==j.search("-")){nom_text=j.split("(");j=nom_text[0];l=nom_text[1];if(!c){a("#peso").show()}l=l.replace("(","");l=l.replace(")","");l=l.replace(" ","");l=l.replace("%","");o=l;a("#peso_editar").val(l);var k=a(this).attr("data-maxweight");a(".maxweight-edit").attr("id",k)}else{j=j.split("-")[0];a("#peso").hide()}}else{a("#type_cal").hide();var l=a(this).parent().parent().prev().text();if("-"==l){a("#peso").hide();a("#peso_editar").val(l)}else{a("#peso").show();l=l.replace("(","");l=l.replace(")","");l=l.replace(" ","");l=l.replace("%","");o=l;a("#peso_editar").val(l);var k=a(this).parent().attr("id");a(".maxweight-edit").attr("id",k)}var i="it",j=a(this).parent().parent().prev().prev().attr("title");if("Enlazar a la actividad Tarea"==j){a("#nombre_editar").hide();a("#label_nombre").hide()}}a("#nombre_editar").val(j);d(e,g,i);a("#edit").modal({backdrop:!1})});function b(b){console.log(b);var c=b.attr("title");a("#titulo").text(c);var e=!1;a("#nombre_editar").show();a("#label_nombre").show();a("#alta").show();a("#div_padres").show();if(b.hasClass("curso")){e=!0;a("#alta").hide();console.log("CURSO");a("#nombre_editar").hide();a("#label_nombre").hide();a("#div_padres").hide()}var g=f(),h=b.attr("id");a("#save_edit").attr("name",h);if("Editar Categor\xEDa"===c){a("#type_cal").show();var i=b.parent().parent().attr("id");a("#otro").hide();if(10!=i&&0!=i&&6!=i){i=99;a("#otro").show()}a("#calific").prop("value",i);var j="cat",k=b.parent().parent().text();if(-1==k.search("-")){nom_text=k.split("(");k=nom_text[0];m=nom_text[1];if(!e){a("#peso").show()}m=m.replace("(","");m=m.replace(")","");m=m.replace(" ","");m=m.replace("%","");o=m;a("#peso_editar").val(m);var l=b.attr("data-maxweight");a(".maxweight-edit").attr("id",l)}else{k=k.split("-")[0];a("#peso").hide()}}else{a("#type_cal").hide();var m=b.parent().parent().prev().text();if("-"==m){a("#peso").hide();a("#peso_editar").val(m)}else{a("#peso").show();m=m.replace("(","");m=m.replace(")","");m=m.replace(" ","");m=m.replace("%","");o=m;a("#peso_editar").val(m);var l=b.parent().attr("id");a(".maxweight-edit").attr("id",l)}var j="it",k=b.parent().parent().prev().prev().attr("title");if("Enlazar a la actividad Tarea"==k){a("#nombre_editar").hide();a("#label_nombre").hide()}}a("#nombre_editar").val(k);d(g,h,j);a("#edit").modal({backdrop:!1})}a(document).on("click","#save_edit",function(){var b=a(this).attr("name"),c=a("#nombre_editar").val(),d=a("#peso_editar").val(),e=parseFloat(a(".maxweight-edit").attr("id"))+parseFloat(o),h=a("#calific").val(),i=a("#padre").val();if("-"==d){d=0}if("99"==h){swal({title:"Tipo de Calificacion no valida.",text:"No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return}console.log("nombre: "+c+"\n peso:"+d+"\n MAXpeso:"+e+"\n new_calif: "+h);if(d>e){swal({title:"Peso no valido.",text:"El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: "+e+"% \n Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return}if(""==c){swal({title:"Ingrese el nuevo nombre del elemento",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return}var j=a("#titulo").text();if("\xCDtem"==j.split(" ")[1]){type_e="it";h=!1}else{type_e="cat"}var k=f();a.ajax({type:"POST",data:{course:k,element:b,type_e:type_e,newNombre:c,newPeso:d,newCalific:h,type:"editElement",parent:i},url:"../managers/grade_categories/grader_processing.php",success:function success(b){if(b.error){swal("Error",b.error,"error")}else{swal({title:"Listo",text:b.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1300});a("#edit").modal("hide");g(k);console.log(b);location.reload()}},dataType:"json",cache:"false",error:function error(a){console.log("AJAXerror");console.log(a)}})});a(document).on("click",".delete",function(){var b=a(this).parent().parent().parent().attr("id").split("_"),c=f(),d=b[1],g=b[0];if("cat"===g){var h="esta categor\xEDa"}else{var h="este item"}var i="Esta seguro que desea eliminar "+h+"?";swal({title:i,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+h,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){if(a){e(d,c,g)}else{swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})}})});function c(a){var b=a.parent().parent().parent().attr("id").split("_"),c=f(),d=b[1],g=b[0];if("cat"===g){var h="esta categor\xEDa"}else{var h="este item"}var i="Esta seguro que desea eliminar "+h+"?";swal({title:i,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+h,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){if(a){e(d,c,g)}else{swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})}})}a(document).on("click",".new",function(){var b=a(this).parent().parent().children().next(".maxweight").attr("id");if(0>=b){swal({title:"No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return}a(".new").prop("disabled",!0);a(".delete").prop("disabled",!0);a(".edit").prop("disabled",!0);var c=a("<div class = 'divForm'>");c.load("../templates/categories_form.html");var d=a(this).parent().parent();d.append("<hr style = \"border-top: 1px solid #ddd\">");d.append(c);window.setTimeout(function(){var b=d.attr("id");if(10==b){a("#divPeso").show();a("#inputValor").on("blur",function(){var b=a(this).val(),c=parseInt(a(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));if(0>b||b>c){swal({title:"El valor debe estar entre 0 y el peso m\xE1ximo: "+c,text:"\n\rUsted ingres\xF3: "+b,html:!0,type:"warning",confirmButtonColor:"#d51b23"});a(this).val("")}});a("#inputValor").on("keypress",function(a){tecla=document.all?a.keyCode:a.which;if(8==tecla||46==tecla){return!0}patron=/[0-9]/;tecla_final=String.fromCharCode(tecla);return patron.test(tecla_final)})}a("#tipoItem").on("change",function(){var b=a(this).prop("selectedIndex");if(1==b){a("#divTipeC").show()}else{a("#divTipeC").hide()}});a("#save").on("click",function(){var b=a(this).parent().parent().parent().parent().attr("id"),c=a(this).parent().parent().parent().parent().parent().attr("id");c=c.split("_")[1];h(b,c)});a("#cancel").on("click",function(){var a=f();g(a)})},400)});function d(b,c,d){a.ajax({type:"POST",data:{course:b,element:c,type_e:d,type:"loadParentCat"},url:"../managers/grade_categories/grader_processing.php",success:function success(b){a("#padre").html(b.html)},dataType:"json",cache:"false",error:function error(a){console.log(a)}})}function e(b,c,d){a.ajax({type:"POST",data:{type_ajax:"deleteElement",id:b,courseid:c,type:d},url:"../managers/grade_categories/grader_processing.php",success:function success(a){swal({title:"Listo",text:a.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200});location.reload();g(c)},dataType:"json",cache:"false",error:function error(a){console.log(a)}})}function f(){for(var a=window.location.search.split("&"),b=0,c;b<a.length;b++){c=a[b].split("=");if("?id_course"==c[0]||"id_course"==c[0]){var d=c[1]}}return d}function g(b){a.ajax({type:"POST",data:{course:b,type:"loadCat"},url:"../managers/grade_categories/grader_processing.php",success:function success(b){a("#mymodalbody").html(b)},dataType:"text",cache:"false",error:function error(a){console.log(a)}})}function h(b,c){var d=a("#tipoItem").val(),e=f();if("CATEGOR\xCDA"==d){if(l(b)){var h=a.trim(a("#inputNombre").val()),m=a("#inputValor").val(),n=i(a("#tipoCalificacion").prop("selectedIndex"));a.ajax({type:"POST",data:{course:e,parent:c,fullname:h,agregation:n,tipo:d,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function success(a){if(1==a){swal({title:"Categoria a\xF1adida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"});g(e)}else if(0==a){swal({title:"Error al a\xF1adir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})}},cache:"false",error:function error(){swal({title:"Error al intentar a\xF1adir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("\xCDTEM"==d){if(j(b)){var h=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:e,parent:c,fullname:h,tipo:d,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function success(a){if(1==a){swal({title:"item a\xF1adido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"});g(e)}else if(0==a){swal({title:"Error al a\xF1adir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})}},cache:"false",error:function error(){swal({title:"Error al intentar a\xF1adir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("PARCIAL"==d){if(k(b)){var h=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:e,parent:c,fullname:h,agregation:6,tipo:d,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function success(a){if(1==a){swal({title:"Categoria a\xF1adida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"});g(e)}else if(0==a){swal({title:"Error al a\xF1adir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})}},cache:"false",error:function error(){swal({title:"Error al intentar a\xF1adir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else{swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}}function i(a){switch(a){case 1:return 0;break;case 2:return 10;break;}}function j(b){var c=a.trim(a("#inputNombre").val());if(""==c){swal({title:"Ingrese el nombre del \xEDtem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}if(10==b){var d=a("#inputValor").val();if(""==d){swal({title:"Ingrese un peso v\xE1lido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}}return!0}function k(b){var c=a.trim(a("#inputNombre").val());if(""==c){swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}if(10==b){var d=a("#inputValor").val();if(""==d){swal({title:"Ingrese un peso v\xE1lido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}}return!0}function l(b){if(0==a("#tipoCalificacion").prop("selectedIndex")){swal({title:"Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}var c=a.trim(a("#inputNombre").val());if(""==c){swal({title:"Ingrese el nombre de la categor\xEDa que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}if(10==b){var d=a("#inputValor").val();if(""==d){swal({title:"Ingrese un peso v\xE1lido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"});return!1}}return!0}}}});
//# sourceMappingURL=wizard_categories.min.js.map
